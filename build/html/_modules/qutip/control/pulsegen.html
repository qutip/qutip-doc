

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="None" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="None" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>qutip.control.pulsegen &mdash; QuTiP: Quantum Toolbox in Python 4.2.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> QuTiP: Quantum Toolbox in Python
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../frontmatter.html">Frontmatter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guide/guide.html">Users Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../apidoc/apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Change Log</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributors.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../biblio.html">Bibliography</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QuTiP: Quantum Toolbox in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qutip.control.pulsegen</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qutip.control.pulsegen</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># This file is part of QuTiP: Quantum Toolbox in Python.</span>
<span class="c1">#</span>
<span class="c1">#    Copyright (c) 2014 and later, Alexander J G Pitchford</span>
<span class="c1">#    All rights reserved.</span>
<span class="c1">#</span>
<span class="c1">#    Redistribution and use in source and binary forms, with or without</span>
<span class="c1">#    modification, are permitted provided that the following conditions are</span>
<span class="c1">#    met:</span>
<span class="c1">#</span>
<span class="c1">#    1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c1">#       this list of conditions and the following disclaimer.</span>
<span class="c1">#</span>
<span class="c1">#    2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c1">#       notice, this list of conditions and the following disclaimer in the</span>
<span class="c1">#       documentation and/or other materials provided with the distribution.</span>
<span class="c1">#</span>
<span class="c1">#    3. Neither the name of the QuTiP: Quantum Toolbox in Python nor the names</span>
<span class="c1">#       of its contributors may be used to endorse or promote products derived</span>
<span class="c1">#       from this software without specific prior written permission.</span>
<span class="c1">#</span>
<span class="c1">#    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<span class="c1">#    &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<span class="c1">#    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A</span>
<span class="c1">#    PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<span class="c1">#    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<span class="c1">#    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<span class="c1">#    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<span class="c1">#    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<span class="c1">#    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<span class="c1">#    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<span class="c1">#    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c1">###############################################################################</span>

<span class="c1"># @author: Alexander Pitchford</span>
<span class="c1"># @email1: agp1@aber.ac.uk</span>
<span class="c1"># @email2: alex.pitchford@gmail.com</span>
<span class="c1"># @organization: Aberystwyth University</span>
<span class="c1"># @supervisor: Daniel Burgarth</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Pulse generator - Generate pulses for the timeslots</span>
<span class="sd">Each class defines a gen_pulse function that produces a float array of</span>
<span class="sd">size num_tslots. Each class produces a differ type of pulse.</span>
<span class="sd">See the class and gen_pulse function descriptions for details</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">import</span> <span class="nn">qutip.logging_utils</span> <span class="k">as</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">qutip.control.dynamics</span> <span class="k">as</span> <span class="nn">dynamics</span>
<span class="kn">import</span> <span class="nn">qutip.control.errors</span> <span class="k">as</span> <span class="nn">errors</span>

<div class="viewcode-block" id="create_pulse_gen"><a class="viewcode-back" href="../../../apidoc/functions.html#qutip.control.pulsegen.create_pulse_gen">[docs]</a><span class="k">def</span> <span class="nf">create_pulse_gen</span><span class="p">(</span><span class="n">pulse_type</span><span class="o">=</span><span class="s1">&#39;RND&#39;</span><span class="p">,</span> <span class="n">dyn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pulse_params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create and return a pulse generator object matching the given type.</span>
<span class="sd">    The pulse generators each produce a different type of pulse,</span>
<span class="sd">    see the gen_pulse function description for details.</span>
<span class="sd">    These are the random pulse options:</span>
<span class="sd">        </span>
<span class="sd">        RND - Independent random value in each timeslot</span>
<span class="sd">        RNDFOURIER - Fourier series with random coefficients</span>
<span class="sd">        RNDWAVES - Summation of random waves</span>
<span class="sd">        RNDWALK1 - Random change in amplitude each timeslot</span>
<span class="sd">        RNDWALK2 - Random change in amp gradient each timeslot</span>
<span class="sd">    </span>
<span class="sd">    These are the other non-periodic options:</span>
<span class="sd">        </span>
<span class="sd">        LIN - Linear, i.e. contant gradient over the time</span>
<span class="sd">        ZERO - special case of the LIN pulse, where the gradient is 0</span>
<span class="sd">    </span>
<span class="sd">    These are the periodic options</span>
<span class="sd">        </span>
<span class="sd">        SINE - Sine wave</span>
<span class="sd">        SQUARE - Square wave</span>
<span class="sd">        SAW - Saw tooth wave</span>
<span class="sd">        TRIANGLE - Triangular wave</span>
<span class="sd">    </span>
<span class="sd">    If a Dynamics object is passed in then this is used in instantiate</span>
<span class="sd">    the PulseGen, meaning that some timeslot and amplitude properties</span>
<span class="sd">    are copied over.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;RND&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenRandom</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;RNDFOURIER&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenRndFourier</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;RNDWAVES&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenRndWaves</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;RNDWALK1&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenRndWalk1</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;RNDWALK2&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenRndWalk2</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;LIN&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenLinear</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;ZERO&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenZero</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;SINE&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenSine</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;SQUARE&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenSquare</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;SAW&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenSaw</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;TRIANGLE&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenTriangle</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;GAUSSIAN&#39;</span><span class="p">:</span>  
        <span class="k">return</span> <span class="n">PulseGenGaussian</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;CRAB_FOURIER&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">PulseGenCrabFourier</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">pulse_type</span> <span class="o">==</span> <span class="s1">&#39;GAUSSIAN_EDGE&#39;</span><span class="p">:</span>  
        <span class="k">return</span> <span class="n">PulseGenGaussianEdge</span><span class="p">(</span><span class="n">dyn</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">pulse_params</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No option for pulse_type &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pulse_type</span><span class="p">))</span></div>


<div class="viewcode-block" id="PulseGen"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGen">[docs]</a><span class="k">class</span> <span class="nc">PulseGen</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pulse generator</span>
<span class="sd">    Base class for all Pulse generators</span>
<span class="sd">    The object can optionally be instantiated with a Dynamics object,</span>
<span class="sd">    in which case the timeslots and amplitude scaling and offset</span>
<span class="sd">    are copied from that.</span>
<span class="sd">    Otherwise the class can be used independently by setting:</span>
<span class="sd">    tau (array of timeslot durations)</span>
<span class="sd">    or</span>
<span class="sd">    num_tslots and pulse_time for equally spaced timeslots</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    num_tslots : integer</span>
<span class="sd">        Number of timeslots, aka timeslices</span>
<span class="sd">        (copied from Dynamics if given)</span>

<span class="sd">    pulse_time : float</span>
<span class="sd">        total duration of the pulse</span>
<span class="sd">        (copied from Dynamics.evo_time if given)</span>

<span class="sd">    scaling : float</span>
<span class="sd">        linear scaling applied to the pulse</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_scaling if given)</span>

<span class="sd">    offset : float</span>
<span class="sd">        linear offset applied to the pulse</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_offset if given)</span>

<span class="sd">    tau : array[num_tslots] of float</span>
<span class="sd">        Duration of each timeslot</span>
<span class="sd">        (copied from Dynamics if given)</span>

<span class="sd">    lbound : float</span>
<span class="sd">        Lower boundary for the pulse amplitudes</span>
<span class="sd">        Note that the scaling and offset attributes can be used to fully</span>
<span class="sd">        bound the pulse for all generators except some of the random ones</span>
<span class="sd">        This bound (if set) may result in additional shifting / scaling</span>
<span class="sd">        Default is -Inf</span>

<span class="sd">    ubound : float</span>
<span class="sd">        Upper boundary for the pulse amplitudes</span>
<span class="sd">        Note that the scaling and offset attributes can be used to fully</span>
<span class="sd">        bound the pulse for all generators except some of the random ones</span>
<span class="sd">        This bound (if set) may result in additional shifting / scaling</span>
<span class="sd">        Default is Inf</span>

<span class="sd">    periodic : boolean</span>
<span class="sd">        True if the pulse generator produces periodic pulses</span>

<span class="sd">    random : boolean</span>
<span class="sd">        True if the pulse generator produces random pulses</span>

<span class="sd">    log_level : integer</span>
<span class="sd">        level of messaging output from the logger.</span>
<span class="sd">        Options are attributes of qutip.logging_utils,</span>
<span class="sd">        in decreasing levels of messaging, are:</span>
<span class="sd">        DEBUG_INTENSE, DEBUG_VERBOSE, DEBUG, INFO, WARN, ERROR, CRITICAL</span>
<span class="sd">        Anything WARN or above is effectively &#39;quiet&#39; execution,</span>
<span class="sd">        assuming everything runs as expected.</span>
<span class="sd">        The default NOTSET implies that the level will be taken from</span>
<span class="sd">        the QuTiP settings file, which by default is WARN</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dyn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">dyn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<div class="viewcode-block" id="PulseGen.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGen.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">):</span>
            <span class="n">dyn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">num_tslots</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">evo_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">initial_ctrl_scaling</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">initial_ctrl_offset</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">tau</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="n">dyn</span><span class="o">.</span><span class="n">log_level</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ramping_pulse</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="PulseGen.apply_params"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGen.apply_params">[docs]</a>    <span class="k">def</span> <span class="nf">apply_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set object attributes based on the dictionary (if any) passed in the </span>
<span class="sd">        instantiation, or passed as a parameter</span>
<span class="sd">        This is called during the instantiation automatically.</span>
<span class="sd">        The key value pairs are the attribute name and value</span>
<span class="sd">        &quot;&quot;&quot;</span>               
        <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">params</span>
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">logger</span><span class="o">.</span><span class="n">level</span>        
        
    <span class="nd">@log_level</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lvl</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the log_level attribute and set the level of the logger</span>
<span class="sd">        that is call logger.setLevel(lvl)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">lvl</span><span class="p">)</span>
        
<div class="viewcode-block" id="PulseGen.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGen.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns the pulse as an array of vales for each timeslot</span>
<span class="sd">        Must be implemented by subclass</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># must be implemented by subclass</span>
        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">UsageError</span><span class="p">(</span>
            <span class="s2">&quot;No method defined for generating a pulse. &quot;</span>
            <span class="s2">&quot; Suspect base class was used where sub class should have been&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="PulseGen.init_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGen.init_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise the pulse parameters</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tau</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;f&#39;</span><span class="p">)</span> <span class="o">*</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubound</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">=</span> <span class="kc">None</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ubound cannot be less the lbound&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_apply_bounds_and_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that the randomly generated pulse fits within the bounds</span>
<span class="sd">        (after applying the offset)</span>
<span class="sd">        Assumes that pulses passed are centered around zero (on average)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="n">max_amp</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>
        <span class="n">min_amp</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_amp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span><span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">min_amp</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="c1"># Some shifting / scaling is required.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># One of the bounds is inf, so just shift the pulse</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># max_amp + offset must exceed the ubound</span>
                <span class="k">return</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">-</span> <span class="n">max_amp</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># min_amp + offset must exceed the lbound</span>
                <span class="k">return</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="o">-</span> <span class="n">min_amp</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bound_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span>
            <span class="n">amp_range</span> <span class="o">=</span> <span class="n">max_amp</span> <span class="o">-</span> <span class="n">min_amp</span>
            <span class="k">if</span> <span class="n">max_amp</span> <span class="o">-</span> <span class="n">min_amp</span> <span class="o">&gt;</span> <span class="n">bound_range</span><span class="p">:</span>
                <span class="c1"># pulse range is too high, it must be scaled</span>
                <span class="n">pulse</span> <span class="o">=</span> <span class="n">pulse</span> <span class="o">*</span> <span class="n">bound_range</span> <span class="o">/</span> <span class="n">amp_range</span>

            <span class="c1"># otherwise the pulse should fit anyway</span>
            <span class="k">return</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_apply_ramping_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse</span><span class="p">,</span> <span class="n">ramping_pulse</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ramping_pulse</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ramping_pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramping_pulse</span>
        <span class="k">if</span> <span class="n">ramping_pulse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pulse</span> <span class="o">=</span> <span class="n">pulse</span><span class="o">*</span><span class="n">ramping_pulse</span>
            
        <span class="k">return</span> <span class="n">pulse</span></div>
        
<div class="viewcode-block" id="PulseGenZero"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenZero">[docs]</a><span class="k">class</span> <span class="nc">PulseGenZero</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a flat pulse</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenZero.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenZero.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse with the same value in every timeslot.</span>
<span class="sd">        The value will be zero, unless the offset is not zero,</span>
<span class="sd">        in which case it will be the offset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PulseGenRandom"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenRandom">[docs]</a><span class="k">class</span> <span class="nc">PulseGenRandom</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates random pulses as simply random values for each timeslot</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenRandom.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenRandom.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="PulseGenRandom.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenRandom.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse of random values between 1 and -1</span>
<span class="sd">        Values are scaled using the scaling property</span>
<span class="sd">        and shifted using the offset property</span>
<span class="sd">        Returns the pulse as an array of vales for each timeslot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">PulseGenRndFourier</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates pulses by summing sine waves as a Fourier series</span>
<span class="sd">    with random coefficients</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    scaling : float</span>
<span class="sd">        The pulses should fit approximately within -/+scaling</span>
<span class="sd">        (before the offset is applied)</span>
<span class="sd">        as it is used to set a maximum for each component wave</span>
<span class="sd">        Use bounds to be sure</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_scaling if given)</span>

<span class="sd">    min_wavelen : float</span>
<span class="sd">        Minimum wavelength of any component wave</span>
<span class="sd">        Set by default to 1/10th of the pulse time</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">min_wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a random pulse based on a Fourier series with a minimum</span>
<span class="sd">        wavelength</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">min_wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="n">min_wavelen</span>
        <span class="n">min_wavelen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span>

        <span class="k">if</span> <span class="n">min_wavelen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum wavelength cannot be greater than &quot;</span>
                             <span class="s2">&quot;the pulse time&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="c1"># use some phase to avoid the first pulse being always 0</span>

        <span class="n">sum_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">wavelen</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">wl</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">wavelen</span> <span class="o">&gt;</span> <span class="n">min_wavelen</span><span class="p">:</span>
            <span class="n">wl</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wavelen</span><span class="p">)</span>
            <span class="n">wavelen</span> <span class="o">=</span> <span class="n">wavelen</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="n">num_comp_waves</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span>
        <span class="n">amp_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">num_comp_waves</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">wavelen</span> <span class="ow">in</span> <span class="n">wl</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">amp_scale</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">phase_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">curr_wave</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">wavelen</span> <span class="o">+</span> <span class="n">phase_off</span><span class="p">)</span>
            <span class="n">sum_wave</span> <span class="o">+=</span> <span class="n">curr_wave</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">sum_wave</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PulseGenRndWaves</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates pulses by summing sine waves with random frequencies</span>
<span class="sd">    amplitudes and phase offset</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    scaling : float</span>
<span class="sd">        The pulses should fit approximately within -/+scaling</span>
<span class="sd">        (before the offset is applied)</span>
<span class="sd">        as it is used to set a maximum for each component wave</span>
<span class="sd">        Use bounds to be sure</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_scaling if given)</span>

<span class="sd">    num_comp_waves : integer</span>
<span class="sd">        Number of component waves. That is the number of waves that</span>
<span class="sd">        are summed to make the pulse signal</span>
<span class="sd">        Set to 20 by default.</span>

<span class="sd">    min_wavelen : float</span>
<span class="sd">        Minimum wavelength of any component wave</span>
<span class="sd">        Set by default to 1/10th of the pulse time</span>

<span class="sd">    max_wavelen : float</span>
<span class="sd">        Maximum wavelength of any component wave</span>
<span class="sd">        Set by default to twice the pulse time</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_comp_waves</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_wavelen</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_wavelen</span> <span class="o">=</span> <span class="mf">10.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_comp_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">min_wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a random pulse by summing sine waves with random freq,</span>
<span class="sd">        amplitude and phase offset</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">num_comp_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_comp_waves</span> <span class="o">=</span> <span class="n">num_comp_waves</span>
        <span class="k">if</span> <span class="n">min_wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span> <span class="o">=</span> <span class="n">min_wavelen</span>
        <span class="k">if</span> <span class="n">max_wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_wavelen</span> <span class="o">=</span> <span class="n">max_wavelen</span>

        <span class="n">num_comp_waves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_comp_waves</span>
        <span class="n">min_wavelen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_wavelen</span>
        <span class="n">max_wavelen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_wavelen</span>

        <span class="k">if</span> <span class="n">min_wavelen</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum wavelength cannot be greater than &quot;</span>
                             <span class="s2">&quot;the pulse time&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_wavelen</span> <span class="o">&lt;=</span> <span class="n">min_wavelen</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Maximum wavelength must be greater than &quot;</span>
                             <span class="s2">&quot;the minimum wavelength&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="c1"># use some phase to avoid the first pulse being always 0</span>

        <span class="n">sum_wave</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">wl_range</span> <span class="o">=</span> <span class="n">max_wavelen</span> <span class="o">-</span> <span class="n">min_wavelen</span>
        <span class="n">amp_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">num_comp_waves</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_comp_waves</span><span class="p">):</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">amp_scale</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">phase_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">wavelen</span> <span class="o">=</span> <span class="n">min_wavelen</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="n">wl_range</span>
            <span class="n">curr_wave</span> <span class="o">=</span> <span class="n">amp</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">t</span><span class="o">/</span><span class="n">wavelen</span> <span class="o">+</span> <span class="n">phase_off</span><span class="p">)</span>
            <span class="n">sum_wave</span> <span class="o">+=</span> <span class="n">curr_wave</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">sum_wave</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PulseGenRndWalk1</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates pulses by using a random walk algorithm</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    scaling : float</span>
<span class="sd">        Used as the range for the starting amplitude</span>
<span class="sd">        Note must used bounds if values must be restricted.</span>
<span class="sd">        Also scales the max_d_amp value</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_scaling if given)</span>

<span class="sd">    max_d_amp : float</span>
<span class="sd">        Maximum amount amplitude will change between timeslots</span>
<span class="sd">        Note this is also factored by the scaling attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_d_amp</span> <span class="o">=</span> <span class="mf">0.1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_d_amp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse by changing the amplitude a random amount between</span>
<span class="sd">        -max_d_amp and +max_d_amp at each timeslot. The walk will start at</span>
<span class="sd">        a random amplitude between -/+scaling.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_d_amp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_d_amp</span> <span class="o">=</span> <span class="n">max_d_amp</span>
        <span class="n">max_d_amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_d_amp</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">walk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">walk</span><span class="p">)):</span>
            <span class="n">walk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span>
            <span class="n">amp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">max_d_amp</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">walk</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PulseGenRndWalk2</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates pulses by using a random walk algorithm</span>
<span class="sd">    Note this is best used with bounds as the walks tend to wander far</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    scaling : float</span>
<span class="sd">        Used as the range for the starting amplitude</span>
<span class="sd">        Note must used bounds if values must be restricted.</span>
<span class="sd">        Also scales the max_d2_amp value</span>
<span class="sd">        (copied from Dynamics.initial_ctrl_scaling if given)</span>

<span class="sd">    max_d2_amp : float</span>
<span class="sd">        Maximum amount amplitude gradient will change between timeslots</span>
<span class="sd">        Note this is also factored by the scaling attribute</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_d2_amp</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_grad_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_d2_amp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse by changing the amplitude gradient a random amount</span>
<span class="sd">        between -max_d2_amp and +max_d2_amp at each timeslot.</span>
<span class="sd">        The walk will start at a random amplitude between -/+scaling.</span>
<span class="sd">        The gradient will start at 0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_d2_amp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_d2_amp</span> <span class="o">=</span> <span class="n">max_d2_amp</span>

        <span class="n">max_d2_amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_d2_amp</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">walk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start amp </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">amp</span><span class="p">))</span>
        <span class="n">grad</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start grad </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">grad</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">walk</span><span class="p">)):</span>
            <span class="n">walk</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">amp</span>
            <span class="n">grad</span> <span class="o">+=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">max_d2_amp</span>
            <span class="n">amp</span> <span class="o">+=</span> <span class="n">grad</span>
            <span class="c1"># print(&quot;grad {}&quot;.format(grad))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">walk</span><span class="p">)</span>


<div class="viewcode-block" id="PulseGenLinear"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenLinear">[docs]</a><span class="k">class</span> <span class="nc">PulseGenLinear</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates linear pulses</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    gradient : float</span>
<span class="sd">        Gradient of the line.</span>
<span class="sd">        Note this is calculated from the start_val and end_val if these</span>
<span class="sd">        are given</span>

<span class="sd">    start_val : float</span>
<span class="sd">        Start point of the line. That is the starting amplitude</span>

<span class="sd">    end_val : float</span>
<span class="sd">        End point of the line.</span>
<span class="sd">        That is the amplitude at the start of the last timeslot</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PulseGenLinear.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenLinear.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="PulseGenLinear.init_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenLinear.init_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the gradient if pulse is defined by start and </span>
<span class="sd">        end point values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">start_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span> <span class="o">=</span> <span class="n">start_val</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="o">=</span> <span class="n">end_val</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_val</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span><span class="p">)</span> <span class="o">/</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span></div>

<div class="viewcode-block" id="PulseGenLinear.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenLinear.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a linear pulse using either the gradient and start value</span>
<span class="sd">        or using the end point to calulate the gradient</span>
<span class="sd">        Note that the scaling and offset parameters are still applied,</span>
<span class="sd">        so unless these values are the default 1.0 and 0.0, then the</span>
<span class="sd">        actual gradient etc will be different</span>
<span class="sd">        Returns the pulse as an array of vales for each timeslot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">gradient</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
                <span class="n">start_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">end_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">start_val</span><span class="p">,</span> <span class="n">end_val</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">):</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradient</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_val</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">y</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PulseGenPeriodic"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenPeriodic">[docs]</a><span class="k">class</span> <span class="nc">PulseGenPeriodic</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intermediate class for all periodic pulse generators</span>
<span class="sd">    All of the periodic pulses range from -1 to 1</span>
<span class="sd">    All have a start phase that can be set between 0 and 2pi</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    num_waves : float</span>
<span class="sd">        Number of complete waves (cycles) that occur in the pulse.</span>
<span class="sd">        wavelen and freq calculated from this if it is given</span>

<span class="sd">    wavelen : float</span>
<span class="sd">        Wavelength of the pulse (assuming the speed is 1)</span>
<span class="sd">        freq is calculated from this if it is given</span>

<span class="sd">    freq : float</span>
<span class="sd">        Frequency of the pulse</span>

<span class="sd">    start_phase : float</span>
<span class="sd">        Phase of the pulse signal when t=0</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenPeriodic.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenPeriodic.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="PulseGenPeriodic.init_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenPeriodic.init_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the wavelength, frequency, number of waves etc</span>
<span class="sd">        from the each other and the other parameters</span>
<span class="sd">        If num_waves is given then the other parameters are worked from this</span>
<span class="sd">        Otherwise if the wavelength is given then it is the driver</span>
<span class="sd">        Otherwise the frequency is used to calculate wavelength and num_waves</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">start_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="n">start_phase</span>

        <span class="k">if</span> <span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span> <span class="o">=</span> <span class="n">num_waves</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span> <span class="o">=</span> <span class="n">wavelen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="n">freq</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freq</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_waves</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelen</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span></div></div>


<div class="viewcode-block" id="PulseGenSine"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSine">[docs]</a><span class="k">class</span> <span class="nc">PulseGenSine</span><span class="p">(</span><span class="n">PulseGenPeriodic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates sine wave pulses</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenSine.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSine.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a sine wave pulse</span>
<span class="sd">        If no params are provided then the class object attributes are used.</span>
<span class="sd">        If they are provided, then these will reinitialise the object attribs.</span>
<span class="sd">        returns the pulse as an array of vales for each timeslot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="n">start_phase</span>

        <span class="k">if</span> <span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="n">num_waves</span><span class="p">,</span> <span class="n">wavelen</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">start_phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PulseGenSquare"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSquare">[docs]</a><span class="k">class</span> <span class="nc">PulseGenSquare</span><span class="p">(</span><span class="n">PulseGenPeriodic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates square wave pulses</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenSquare.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSquare.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a square wave pulse</span>
<span class="sd">        If no parameters are pavided then the class object attributes are used.</span>
<span class="sd">        If they are provided, then these will reinitialise the object attribs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="n">start_phase</span>

        <span class="k">if</span> <span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="n">num_waves</span><span class="p">,</span> <span class="n">wavelen</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">start_phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">y</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PulseGenSaw"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSaw">[docs]</a><span class="k">class</span> <span class="nc">PulseGenSaw</span><span class="p">(</span><span class="n">PulseGenPeriodic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates saw tooth wave pulses</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenSaw.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenSaw.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a saw tooth wave pulse</span>
<span class="sd">        If no parameters are pavided then the class object attributes are used.</span>
<span class="sd">        If they are provided, then these will reinitialise the object attribs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="n">start_phase</span>

        <span class="k">if</span> <span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="n">num_waves</span><span class="p">,</span> <span class="n">wavelen</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">start_phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">))</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">y</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="PulseGenTriangle"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenTriangle">[docs]</a><span class="k">class</span> <span class="nc">PulseGenTriangle</span><span class="p">(</span><span class="n">PulseGenPeriodic</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates triangular wave pulses</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenTriangle.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenTriangle.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_waves</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wavelen</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">freq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_phase</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a sine wave pulse</span>
<span class="sd">        If no parameters are pavided then the class object attributes are used.</span>
<span class="sd">        If they are provided, then these will reinitialise the object attribs</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">start_phase</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">=</span> <span class="n">start_phase</span>

        <span class="k">if</span> <span class="n">num_waves</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">wavelen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">freq</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="n">num_waves</span><span class="p">,</span> <span class="n">wavelen</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">start_phase</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">freq</span><span class="o">*</span><span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_phase</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.0</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">phase</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="n">x</span><span class="p">)))</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">y</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>
        
<div class="viewcode-block" id="PulseGenGaussian"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussian">[docs]</a><span class="k">class</span> <span class="nc">PulseGenGaussian</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates pulses with a Gaussian profile</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="PulseGenGaussian.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussian.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variance</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="PulseGenGaussian.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussian.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">variance</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse with Gaussian shape. The peak is centre around the</span>
<span class="sd">        mean and the variance determines the breadth</span>
<span class="sd">        The scaling and offset attributes are applied as an amplitude</span>
<span class="sd">        and fixed linear offset. Note that the maximum amplitude will be</span>
<span class="sd">        scaling + offset.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">mean</span><span class="p">:</span>
            <span class="n">Tm</span> <span class="o">=</span> <span class="n">mean</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean</span>
        <span class="k">if</span> <span class="n">variance</span><span class="p">:</span>
            <span class="n">Tv</span> <span class="o">=</span> <span class="n">variance</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Tv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variance</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>

        <span class="n">pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">Tm</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Tv</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>

<div class="viewcode-block" id="PulseGenGaussianEdge"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussianEdge">[docs]</a><span class="k">class</span> <span class="nc">PulseGenGaussianEdge</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate pulses with inverted Gaussian ramping in and out</span>
<span class="sd">    It&#39;s intended use for a ramping modulation, which is often required in </span>
<span class="sd">    experimental setups.</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">        decay_time : float</span>
<span class="sd">            Determines the ramping rate. It is approximately the time</span>
<span class="sd">            required to bring the pulse to full amplitude</span>
<span class="sd">            It is set to 1/10 of the pulse time by default</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PulseGenGaussianEdge.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussianEdge.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">decay_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>

<div class="viewcode-block" id="PulseGenGaussianEdge.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenGaussianEdge.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">decay_time</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse that starts and ends at zero and 1.0 in between</span>
<span class="sd">        then apply scaling and offset</span>
<span class="sd">        The tailing in and out is an inverted Gaussian shape</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>
            
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
        <span class="k">if</span> <span class="n">decay_time</span><span class="p">:</span>
            <span class="n">Td</span> <span class="o">=</span> <span class="n">decay_time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Td</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decay_time</span>
        <span class="n">T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Td</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">t</span><span class="o">-</span><span class="n">T</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">Td</span><span class="p">)</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">pulse</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds_and_offset</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>


<span class="c1">### The following are pulse generators for the CRAB algorithm ###</span>
<span class="c1"># AJGP 2015-05-14: </span>
<span class="c1"># The intention is to have a more general base class that allows</span>
<span class="c1"># setting of general basis functions</span>

<div class="viewcode-block" id="PulseGenCrab"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab">[docs]</a><span class="k">class</span> <span class="nc">PulseGenCrab</span><span class="p">(</span><span class="n">PulseGen</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all CRAB pulse generators</span>
<span class="sd">    Note these are more involved in the optimisation process as they are</span>
<span class="sd">    used to produce piecewise control amplitudes each time new optimisation</span>
<span class="sd">    parameters are tried</span>
<span class="sd">    </span>
<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    num_coeffs : integer</span>
<span class="sd">        Number of coefficients used for each basis function</span>
<span class="sd">        </span>
<span class="sd">    num_basis_funcs : integer</span>
<span class="sd">        Number of basis functions</span>
<span class="sd">        In this case set at 2 and should not be changed</span>
<span class="sd">        </span>
<span class="sd">    coeffs : float array[num_coeffs, num_basis_funcs]</span>
<span class="sd">        The basis coefficient values</span>
<span class="sd">        </span>
<span class="sd">    randomize_coeffs : bool</span>
<span class="sd">        If True (default) then the coefficients are set to some random values</span>
<span class="sd">        when initialised, otherwise they will all be equal to self.scaling</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dyn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_coeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">dyn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">=</span> <span class="n">num_coeffs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        
<div class="viewcode-block" id="PulseGenCrab.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NUM_COEFFS_WARN_LVL</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DEF_NUM_COEFFS</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_ALL</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_GT_MEAN</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_LT_MEAN</span> <span class="o">=</span> <span class="mi">3</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_uses_time</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_basis_funcs</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_optim_vars</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randomize_coeffs</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_coeffs_estimated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_action</span> <span class="o">=</span> <span class="s1">&#39;MODULATE&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_params</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="PulseGenCrab.init_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.init_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_coeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial freq and coefficient values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGen</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_coeffs</span><span class="p">(</span><span class="n">num_coeffs</span><span class="o">=</span><span class="n">num_coeffs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_guess_pulse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_bounds</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_coeffs_estimated</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;CRAB pulse initialised with </span><span class="si">{}</span><span class="s2"> coefficients per basis &quot;</span>
                    <span class="s2">&quot;function, which means a total of </span><span class="si">{}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;optimisation variables for this pulse&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_optim_vars</span><span class="p">))</span></div>
        
<span class="c1">#    def generate_guess_pulse(self)</span>
<span class="c1">#        if isinstance(self.guess_pulsegen, PulseGen):</span>
<span class="c1">#            self.guess_pulse = self.guess_pulsegen.gen_pulse()</span>
<span class="c1">#        return self.guess_pulse</span>
        
<div class="viewcode-block" id="PulseGenCrab.init_coeffs"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.init_coeffs">[docs]</a>    <span class="k">def</span> <span class="nf">init_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_coeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the initial ceofficent values.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_coeffs : integer</span>
<span class="sd">            Number of coefficients used for each basis function</span>
<span class="sd">            If given this overides the default and sets the attribute</span>
<span class="sd">            of the same name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">num_coeffs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">=</span> <span class="n">num_coeffs</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_coeffs_estimated</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">dynamics</span><span class="o">.</span><span class="n">Dynamics</span><span class="p">):</span>
                <span class="n">dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_drift_dim</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">estimate_num_coeffs</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_num_coeffs_estimated</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEF_NUM_COEFFS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_optim_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_basis_funcs</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_coeffs_estimated</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;The number of CRAB coefficients per basis function &quot;</span>
                    <span class="s2">&quot;has been estimated as </span><span class="si">{}</span><span class="s2">, which means a total of </span><span class="si">{}</span><span class="s2"> &quot;</span>
                    <span class="s2">&quot;optimisation variables for this pulse. Based on the &quot;</span>
                    <span class="s2">&quot;dimension (</span><span class="si">{}</span><span class="s2">) of the system&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_optim_vars</span><span class="p">,</span> <span class="n">dim</span><span class="p">))</span>
            <span class="c1"># Issue warning if beyond the recommended level</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_level</span> <span class="o">&lt;=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARN</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM_COEFFS_WARN_LVL</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                        <span class="s2">&quot;The estimated number of coefficients </span><span class="si">{}</span><span class="s2"> exceeds &quot;</span>
                        <span class="s2">&quot;the amount (</span><span class="si">{}</span><span class="s2">) recommended for efficient &quot;</span>
                        <span class="s2">&quot;optimisation. You can set this level explicitly &quot;</span>
                        <span class="s2">&quot;to suppress this message.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM_COEFFS_WARN_LVL</span><span class="p">))</span>
                            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">randomize_coeffs</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_basis_funcs</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">r</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> 
                                   <span class="bp">self</span><span class="o">.</span><span class="n">num_basis_funcs</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scaling</span></div>
        
<div class="viewcode-block" id="PulseGenCrab.estimate_num_coeffs"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.estimate_num_coeffs">[docs]</a>    <span class="k">def</span> <span class="nf">estimate_num_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Estimate the number coefficients based on the dimensionality of the</span>
<span class="sd">        system.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        num_coeffs : int</span>
<span class="sd">            estimated number of coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">num_coeffs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">num_coeffs</span></div>
        
<div class="viewcode-block" id="PulseGenCrab.get_optim_var_vals"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.get_optim_var_vals">[docs]</a>    <span class="k">def</span> <span class="nf">get_optim_var_vals</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the parameter values to be optimised</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list (or 1d array) of floats </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="PulseGenCrab.set_optim_var_vals"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrab.set_optim_var_vals">[docs]</a>    <span class="k">def</span> <span class="nf">set_optim_var_vals</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the values of the any of the pulse generation parameters</span>
<span class="sd">        based on new values from the optimisation method</span>
<span class="sd">        Typically this will be the basis coefficients</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Type and size checking avoided here as this is in the </span>
        <span class="c1"># main optmisation call sequence</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coeffs</span><span class="p">(</span><span class="n">param_vals</span><span class="p">)</span></div>
        
    <span class="k">def</span> <span class="nf">set_coeffs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_vals</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="n">param_vals</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
                    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_basis_funcs</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">init_guess_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_action</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">WARN</span><span class="p">(</span><span class="s2">&quot;No guess pulse action given, hence ignored.&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_action</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;MODULATE&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_modulate</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_action</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;ADD&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_add</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">WARN</span><span class="p">(</span><span class="s2">&quot;No option for guess pulse action &#39;</span><span class="si">{}</span><span class="s2">&#39; &quot;</span>
                        <span class="s2">&quot;, hence ignored.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_action</span><span class="p">))</span>
    
    <span class="k">def</span> <span class="nf">guess_pulse_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse</span><span class="p">):</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">pulse</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span>
        <span class="k">return</span> <span class="n">pulse</span>
        
    <span class="k">def</span> <span class="nf">guess_pulse_modulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse</span><span class="p">):</span>
        <span class="n">pulse</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">pulse</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span>
        <span class="k">return</span> <span class="n">pulse</span>
        
    <span class="k">def</span> <span class="nf">_init_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">add_guess_pulse_scale</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># no bounds to apply</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># only upper bound</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add_guess_pulse_scale</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_guess_pulse_scale</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span> <span class="o">=</span> <span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_GT_MEAN</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># only lower bound</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span> <span class="o">+</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">get_guess_pulse_scale</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_LT_MEAN</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># lower and upper bounds</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ubound</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">lbound</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_ALL</span>
            
    <span class="k">def</span> <span class="nf">get_guess_pulse_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">scale</span>
        
    <span class="k">def</span> <span class="nf">_apply_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pulse</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Scaling the amplitudes using the tanh function if there are bounds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_ALL</span><span class="p">:</span>
            <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span>
            <span class="k">return</span> <span class="n">pulse</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_GT_MEAN</span><span class="p">:</span>
            <span class="n">scale_where</span> <span class="o">=</span> <span class="n">pulse</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">scale_where</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">pulse</span><span class="p">[</span><span class="n">scale_where</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span>
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pulse</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale_cond</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BSC_LT_MEAN</span><span class="p">:</span>
            <span class="n">scale_where</span> <span class="o">=</span> <span class="n">pulse</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span>
            <span class="n">pulse</span><span class="p">[</span><span class="n">scale_where</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">pulse</span><span class="p">[</span><span class="n">scale_where</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_bound_scale</span>
                                        <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_mean</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pulse</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pulse</span></div>
       

<div class="viewcode-block" id="PulseGenCrabFourier"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrabFourier">[docs]</a><span class="k">class</span> <span class="nc">PulseGenCrabFourier</span><span class="p">(</span><span class="n">PulseGenCrab</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a pulse using the Fourier basis functions, i.e. sin and cos</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    freqs : float array[num_coeffs]</span>
<span class="sd">        Frequencies for the basis functions</span>
<span class="sd">    randomize_freqs : bool</span>
<span class="sd">        If True (default) the some random offset is applied to the frequencies</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="PulseGenCrabFourier.reset"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrabFourier.reset">[docs]</a>    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        reset attributes to default values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGenCrab</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randomize_freqs</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="PulseGenCrabFourier.init_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrabFourier.init_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_coeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the initial freq and coefficient values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">PulseGenCrab</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">init_freqs</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="PulseGenCrabFourier.init_freqs"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrabFourier.init_freqs">[docs]</a>    <span class="k">def</span> <span class="nf">init_freqs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the frequencies</span>
<span class="sd">        These are the Fourier harmonics with a uniformly distributed</span>
<span class="sd">        random offset</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">)</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">pulse_time</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ff</span><span class="o">*</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">randomize_freqs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span></div>
        
<div class="viewcode-block" id="PulseGenCrabFourier.gen_pulse"><a class="viewcode-back" href="../../../apidoc/classes.html#qutip.control.pulsegen.PulseGenCrabFourier.gen_pulse">[docs]</a>    <span class="k">def</span> <span class="nf">gen_pulse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coeffs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a pulse using the Fourier basis with the freqs and</span>
<span class="sd">        coeffs attributes.</span>
<span class="sd">        </span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        coeffs : float array[num_coeffs, num_basis_funcs]</span>
<span class="sd">            The basis coefficient values</span>
<span class="sd">            If given this overides the default and sets the attribute</span>
<span class="sd">            of the same name.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">coeffs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span> <span class="o">=</span> <span class="n">coeffs</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pulse_initialised</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_pulse</span><span class="p">()</span>
        
        <span class="n">pulse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_tslots</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_coeffs</span><span class="p">):</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span>
<span class="c1">#            basis1comp = self.coeffs[i, 0]*np.sin(phase)</span>
<span class="c1">#            basis2comp = self.coeffs[i, 1]*np.cos(phase)</span>
<span class="c1">#            pulse += basis1comp + basis2comp</span>
            <span class="n">pulse</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="bp">self</span><span class="o">.</span><span class="n">coeffs</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span> 

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span><span class="p">:</span>
            <span class="n">pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guess_pulse_func</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramping_pulse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pulse</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_ramping_pulse</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_bounds</span><span class="p">(</span><span class="n">pulse</span><span class="p">)</span></div></div>
    
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, P.D. Nation, J.R. Johansson, A.J.G. Pitchford, C. Granade, and A.L. Grimsmo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>